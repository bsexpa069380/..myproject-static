<!DOCTYPE html>
<html dir="ltr" lang="tw">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta http-equiv="x-ua-compatible" content="IE=edge">
<meta name="author" content="Action Sharon James">
<meta name="description" content="峻勝建設開發官網">

<!-- Font Imports -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

<!-- Core Style -->
<link rel="stylesheet" href="/static/web/style.css">

<!-- Font Icons -->
<link rel="stylesheet" href="/static/web/css/font-icons.css">

<!-- Plugins/Components CSS -->
<link rel="stylesheet" href="/static/web/css/swiper.css">

<!-- Custom CSS -->
<link rel="stylesheet" href="/static/web/css/custom.css">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Document Title
	============================================= -->
<title>邑城仰睦-最新情報</title>
<style>
.news-cover-crop {
    width: 100%;
    height: 0;
    padding-bottom: 77.94%; /* (530/680 = 0.7794) This maintains the aspect ratio */
    position: relative;
    overflow: hidden;
}

.news-cover-crop img {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.feature-box.media-box {
    margin-bottom: 30px;
}

/* Optional: limit maximum width of the image container in very large screens */
@media (min-width: 1400px) {
    .fbox-media {
        max-width: 400px;
        margin: 0 auto;
    }
}
</style>
</head>

<body class="stretched overlay-menu">

<!-- Document Wrapper
	============================================= -->
<div id="wrapper">
  <header id="header" class="full-header transparent-header transparent-header-responsive" >
    <div id="header-wrap">
      <div class="container">
        <div class="header-row"> 
          
          <!-- Logo
						============================================= -->
          <div id="logo"> <a href="/static/web/index.html"> <img class="logo-default" srcset="/static/web/images/logo.png" src="/static/web/images/logo.png" alt="Logo"> <img class="logo-dark" srcset="/static/web/images/logo.png" src="/static/web/images/logo.png" alt="Logo"> </a> </div>
          <!-- #logo end -->
          
          <div class="primary-menu-trigger">
            <button class="cnvs-hamburger" type="button" title="Open Mobile Menu"> <span class="cnvs-hamburger-box"><span class="cnvs-hamburger-inner"></span></span> </button>
          </div>
          
          <!-- Primary Navigation
						============================================= -->
          <nav class="primary-menu">
            <button class="menu-close" type="button" title="關閉選單"> <span class="menu-close-icon"></span> </button>
            <ul class="menu-container">
              <li class="menu-item">
                <a class="menu-link" href="/static/web/about.html"><div>關於峻勝<br>ABOUT</div></a> 
              </li>
              <li class="menu-item"> 
                <a class="menu-link" href="/static/web/news.html"><div>最新情報<br>NEWS</div></a> 
              </li>
              <li class="menu-item"> 
                <a class="menu-link" href="/static/web/teams.html"><div>專業陣容<br>TEAM</div></a> 
              </li>
              <li class="menu-item"> 
                <a class="menu-link" href="/static/web/project.html"><div>峻勝築績<br>PROJECT</div></a> 
              </li>
              <li class="menu-item"> 
                <a class="menu-link" href="/static/web/renew.html"><div>合作專區<br>RENEW</div></a> 
              </li>
              <li class="menu-item"> 
                <a class="menu-link" href="/static/web/service.html"><div>客户中心<br>SERVICE</div></a> 
              </li>
              <li class="menu-item"> 
                <a class="menu-link" href="/static/web/contact.html"><div>聯絡我們<br>CONTACT</div></a> 
              </li>
            </ul>
          </nav>
          <!-- #primary-menu end --> 
          
        </div>
      </div>
    </div>
    <div class="header-wrap-clone"></div>
  </header>
  
  <!-- 個案新訊
		============================================= -->
  <section id="case">
    <div class="content-wrap py-lg-0">
      <div class="container"> 
        <div class="row align-items-lg-center gutter-50 mb-4">
          <div class="col-lg-12 align-sel f-center">
            <div class="custom-title-box">
              <h2 class="custom-title">個案新訊</h2>
            </div>
          </div>
        </div>
        <div class="row">
          <!-- News items will be dynamically inserted here -->
        </div>
      </div>
    </div>
  </section>
  <!-- #個案新訊 end --> 
  
  <!-- 過場線
		============================================= -->
  <div class="svg-divider mb-6">
    <svg id="" data-name="" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1480.3 104.1">
      <polyline class="st0" points="0 .5 740.2 103.6 1480.3 .5"/>
    </svg>
  </div>
  
  <!-- #過場線 end --> 
  
  <!-- 政策快遞 Policy Express
		============================================= -->
  <section id="policy">
    <div class="content-wrap py-0">
      <div class="container"> 
        <div class="row align-items-start gutter-50 mb-4">
          <div class="col-lg-12 align-sel f-center">
            <div class="custom-title-box">
              <h2 class="custom-title">政策快遞</h2>
            </div>
          </div>
        </div>
        <div class="row">
          <!-- News items will be dynamically inserted here -->
        </div>
      </div>
    </div>
  </section>
  <!-- #政策快遞 end --> 
  
  <!-- 過場線
		============================================= -->
  <div class="svg-divider mb-6">
    <svg id="" data-name="" xmlns="http://www.w3.org/2000/svg" version="1.1" viewBox="0 0 1480.3 104.1">
      <polyline class="st0" points="0 .5 740.2 103.6 1480.3 .5"/>
    </svg>
  </div>
  
  <!-- #過場線 end --> 
  
  <!-- 房市新訊 Housing Market News
		============================================= -->
  <section id="h-market">
    <div class="content-wrap py-0">
      <div class="container"> 
        <div class="row align-items-lg-center gutter-50 mb-4">
          <div class="col-lg-12 align-sel f-center">
            <div class="custom-title-box">
              <h2 class="custom-title">房市新訊</h2>
            </div>
          </div>
        </div>
        <div class="row">
          <!-- News items will be dynamically inserted here -->
        </div>
      </div>
    </div>
  </section>
  <!-- #房市新訊 end --> 
  
  <!-- Footer
		============================================= -->
  <footer id="footer" class="bg-primary dark border-width-1 border-f5 block-footer-1">
    <div class="container"> 
      
      <!-- Footer Widgets
				============================================= -->
      <div class="footer-widgets-wrap">
        <div class="row col-mb-50">
          <div class="col-lg-3 col-sm-12 order-2 order-lg-1">
            <div class="widget"> <img src="/static/web/assets/footer-logo.png" alt="Image" class="footer-logo" height="60"> </div>
            <p>服務時間:週一至週五(09:00〜18:00)<br>
              地址:新北市板橋區民生路1段33號5樓之2<br>
              電話:02-2951-2789</p>
            <div> <a href="#" class="social-icon border-transparent h-bg-facebook"> <i class="fa-brands fa-facebook-f"></i> <i class="fa-brands fa-facebook-f"></i> </a> <a href="#" class="social-icon border-transparent h-bg-line"> <i class="bi-line"></i> <i class="bi-line"></i> </a> <a href="#" class="social-icon border-transparent h-bg-instagram"> <i class="bi-instagram"></i> <i class="bi-instagram"></i> </a> </div>
          </div>
          <div class="col-lg-9 col-sm-12 order-1 order-lg-2">
            <div class="row">
              <div class="col-lg-f-7 col-3 mb-5">
                <div class="widget widget_links">
                  <h4 class="text-transform-none ls-0 text-center">關於峻勝<br>
                    ABOUT</h4>
                  <ul>
                    <li><a href="/static/web/about.html">關於峻勝</a></li>
                    <li><a href="/static/web/about.html#brand-senses">核心理念</a></li>
                    <li><a href="/static/web/about.html#cooperate">緣起合建</a></li>
                    <li><a href="/static/web/about.html#sustainability">永續價值</a></li>
                    <li><a href="/static/web/about.html#charity">公益活動</a></li>
                    <li><a href="/static/web/about.html#6s">六感建築</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-f-7 col-3">
                <div class="widget widget_links">
                  <h4 class="text-transform-none ls-0 text-center">最新情報<br>
                    NEWS</h4>
                  <ul>
                    <li><a href="/static/web/news.html#case">個案新訊</a></li>
                    <li><a href="/static/web/news.html#policy">政策快遞</a></li>
                    <li><a href="/static/web/news.html#h-market">房市新讯</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-f-7 col-3">
                <div class="widget widget_links">
                  <h4 class="text-transform-none ls-0 text-center">專業陣容<br>
                    TEAM</h4>
                  <ul>
                    <li><a href="/static/web/teams.html#create">營造陣容</a></li>
                    <li><a href="/static/web/teams.html#building">建築陣容</a></li>
                    <li><a href="/static/web/teams.html#design">設計陣容</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-f-7 col-3">
                <div class="widget widget_links">
                  <h4 class="text-transform-none ls-0 text-center">峻勝築績<br>
                    PROJECT</h4>
                  <ul>
                    <li><a href="/static/web/project.html#hotline">線上熱銷</a></li>
                    <li><a href="/static/web/project.html#history">歷年業績</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-f-7 col-3">
                <div class="widget widget_links">
                  <h4 class="text-transform-none ls-0 text-center">合作專區<br>
                    RENEW</h4>
                  <ul>
                    <li><a href="/static/web/renew.html#renewal-oldage">都更危老</a></li>
                    <li><a href="/static/web/renew.html#advantages1">峻勝優勢</a></li>
                    <li><a href="/static/web/renew.html#cityrenew">都更專區</a></li>
                    <li><a href="/static/web/renew.html#dan-oldhouse">危老專區</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-f-7 col-3">
                <div class="widget widget_links">
                  <h4 class="text-transform-none ls-0 text-center">客户中心<br>
                    SERVICE</h4>
                  <ul>
                    <li><a href="/static/web/service.html#project-progress">工程進度</a></li>
                    <li><a href="/static/web/service.html#pay-history">繳款紀錄</a></li>
                    <li><a href="/static/web/service.html#online-repair">線上報修</a></li>
                  </ul>
                </div>
              </div>
              <div class="col-lg-f-7 col-3">
                <div class="widget widget_links">
                  <h4 class="text-transform-none ls-0 text-center">聯絡我們<br>
                    CONTACT</h4>
                  <ul>
                    <li><a href="/static/web/contact.html">意見回饋</a></li>
                    <li><a href="/static/web/contact.html#footer">基本資料</a></li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- .footer-widgets-wrap end --> 
      
    </div>
    
    <!-- Copyrights
			============================================= --> 
    <!-- #copyrights end --> 
  </footer>
  <!-- #footer end --> 
  
</div>
<!-- #wrapper end --> 

<!-- Go To Top
	============================================= -->
<div id="gotoTop" class="uil uil-angle-up"></div>

<!-- JavaScripts
	============================================= --> 
<script src="/static/web/js/plugins.min.js"></script> 
<script src="/static/web/js/functions.bundle.js"></script> 
<script src="/static/web/js/menu.js"></script>

<script>
// Function to format date
function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString('zh-TW', {
        year: 'numeric',
        month: '2-digit',
        day: '2-digit'
    }).replace(/\//g, '-');
}

// Helper to get correct image URL
function getImageUrl(cover_image) {
  if (!cover_image) return '/static/web/assets/news/placeholder.png'; // fallback
  if (cover_image.startsWith('http://') || cover_image.startsWith('https://')) {
    return cover_image;
  }
  return '/' + cover_image.replace(/^\/+/,'');
}

// Function to create news item HTML
function createNewsItem(news, index, section) {
    const isEven = index % 2 === 0;
    const imageUrl = getImageUrl(news.cover_image);
    return `
        <div class="col-md-4">
            <div class="row feature-box media-box zoom">
                ${isEven ? `
                    <div class="col-12 fbox-media">
                        ${section === 'case' ? 
                            `<a href="/static/web/news-article.html?id=${news.id}">
                                <div class="news-cover-crop">
                                    <img src="${imageUrl}" alt="${news.title}">
                                </div>
                             </a>` : 
                            `<a href="${news.link}" target="_blank">
                                <div class="news-cover-crop">
                                    <img src="${imageUrl}" alt="${news.title}">
                                </div>
                             </a>`}
                    </div>
                    <div class="col-12 text-center">
                        ${section === 'case' ? `<a href="/static/web/news-article.html?id=${news.id}"><h4 style="color: #C49A6C;">${news.title}</h4><p style="color: #C49A6C;">${formatDate(news.created_at)}</p></a>` : `<h4 style=\"color: #C49A6C;\">${news.title}</h4><p style=\"color: #C49A6C;\">${formatDate(news.created_at)}</p>`}
                    </div>
                ` : `
                    <div class="col-12 text-center order-2 order-lg-1">
                        ${section === 'case' ? `<a href="/static/web/news-article.html?id=${news.id}"><h4 style="color: #C49A6C;">${news.title}</h4><p style="color: #C49A6C;">${formatDate(news.created_at)}</p></a>` : `<h4 style=\"color: #C49A6C;\">${news.title}</h4><p style=\"color: #C49A6C;\">${formatDate(news.created_at)}</p>`}
                    </div>
                    <div class="col-12 fbox-media order-1 order-lg-2">
                        ${section === 'case' ? 
                            `<a href="/static/web/news-article.html?id=${news.id}">
                                <div class="news-cover-crop">
                                    <img src="${imageUrl}" alt="${news.title}">
                                </div>
                             </a>` : 
                            `<a href="${news.link}" target="_blank">
                                <div class="news-cover-crop">
                                    <img src="${imageUrl}" alt="${news.title}">
                                </div>
                             </a>`}
                    </div>
                `}
            </div>
        </div>
    `;
}

// Function to fetch and display news by category
async function fetchNewsByCategory(category, containerId) {
    try {
        let response;
        if (category === 'case') {
            // Use the cases API for 個案新訊 section
            response = await fetch('/api/cases', {
                credentials: 'include'
            });
        } else {
            // Use the news-articles API for other sections
            response = await fetch(`/api/news-articles?category=${category}`, {
                credentials: 'include'
            });
        }
        
        if (!response.ok) {
            throw new Error('Failed to fetch news');
        }
        
        const news = await response.json();
        const container = document.querySelector(`#${containerId} .container > .row:last-child`);
        
        if (!container) {
            console.error(`Container not found for ${containerId}`);
            return;
        }
        
        // Clear existing content
        container.innerHTML = '';
        
        if (news.length === 0) {
            container.innerHTML = '<div class="col-12 text-center">尚無新聞資料</div>';
            return;
        }
        
        // Sort news by created_at in descending order (newest first)
        news.sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
        
        // Take only the first 3 news items
        const latestNews = news.slice(0, 3);
        
        // Create and append news items
        latestNews.forEach((item, index) => {
            container.innerHTML += createNewsItem(item, index, category);
        });
        
    } catch (error) {
        console.error(`Error fetching ${category} news:`, error);
        const container = document.querySelector(`#${containerId} .container > .row:last-child`);
        if (container) {
            container.innerHTML = '<div class="col-12 text-center text-danger">載入新聞資料失敗</div>';
        }
    }
}

// Load news when the page loads
document.addEventListener('DOMContentLoaded', () => {
    fetchNewsByCategory('case', 'case');  // Changed from 'real_estate_news' to 'case'
    fetchNewsByCategory('policy_express', 'policy');
    fetchNewsByCategory('real_estate_news', 'h-market');
});
</script>
</body>
</html>